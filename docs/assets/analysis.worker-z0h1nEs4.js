(function(){"use strict";const N=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","as","is","was","are","were","been","be","have","has","had","do","does","did","will","would","could","should","may","might","must","shall","can","need","it","its","this","that","these","those","i","you","he","she","we","they","what","which","who","whom","how","when","where","why","all","each","every","both","few","more","most","other","some","such","no","not","only","same","so","than","too","very","just","also","now","new","says","said","after"]),P=5,G=2,F=3,R=1.5,_=new Set(["CL=F","NG=F"]),V=["pipeline","pipelines","line","terminal"],$=["flow","throughput","capacity","outage","leak","rupture","shutdown","maintenance","curtailment","force majeure","halt","halted","reduced","reduction","drop","offline","suspend","suspended","stoppage"],H=["iran","israel","ukraine","russia","china","taiwan","oil","crypto","fed","interest","inflation","recession","war","sanctions","tariff","ai","tech","layoff","trump","biden","election"],z={iran:["iran","israel","oil","sanctions"],israel:["israel","iran","war","gaza"],ukraine:["ukraine","russia","war","nato"],russia:["russia","ukraine","sanctions"],china:["china","taiwan","tariff","trade"],taiwan:["taiwan","china"],trump:["trump","election","tariff"],fed:["fed","interest","inflation","recession"],bitcoin:["crypto","bitcoin"],recession:["recession","fed","inflation"]};function j(n){const i=n.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(e=>e.length>2&&!N.has(e));return new Set(i)}function X(n,i){if(n.size===0&&i.size===0)return 0;const e=new Set([...n].filter(d=>i.has(d))),c=new Set([...n,...i]);return e.size/c.size}function E(n,i){return i.some(e=>n.includes(e))}function K(n){const i=n.toLowerCase(),e=[];for(const[c,d]of Object.entries(z))i.includes(c)&&e.push(...d);return[...new Set(e)]}function M(){return`sig-${Date.now()}-${Math.random().toString(36).slice(2,8)}`}function I(n,i,e){if(["silent_divergence","flow_price_divergence","explained_market_move"].includes(n))return`${n}:${i}`;const d=Math.round(e*10)/10;return`${n}:${i}:${d}`}const W=[{id:"^GSPC",type:"index",name:"S&P 500",aliases:["s&p","s&p 500","sp500","spx","spy"],keywords:["market","stocks","wall street","equities"],related:["^DJI","^IXIC"]},{id:"^DJI",type:"index",name:"Dow Jones",aliases:["dow","dow jones","djia","dow 30"],keywords:["blue chip","industrials","market"],related:["^GSPC","^IXIC"]},{id:"^IXIC",type:"index",name:"NASDAQ",aliases:["nasdaq","nasdaq composite","qqq","tech index"],keywords:["tech stocks","growth","technology"],related:["^GSPC","XLK"]},{id:"AAPL",type:"company",name:"Apple Inc.",aliases:["apple","aapl","tim cook","iphone","ipad","mac"],keywords:["iphone","ios","app store","macbook","vision pro","services","wearables"],sector:"Technology",related:["MSFT","GOOGL","TSM"]},{id:"MSFT",type:"company",name:"Microsoft Corporation",aliases:["microsoft","msft","satya nadella","windows","azure","xbox"],keywords:["azure","cloud","windows","office","copilot","openai","teams","github"],sector:"Technology",related:["AAPL","GOOGL","AMZN","NVDA"]},{id:"NVDA",type:"company",name:"NVIDIA Corporation",aliases:["nvidia","nvda","jensen huang","geforce"],keywords:["gpu","ai chip","datacenter","cuda","h100","blackwell","artificial intelligence","gaming","graphics"],sector:"Technology",related:["AMD","TSM","AVGO","INTC","MSFT"]},{id:"GOOGL",type:"company",name:"Alphabet Inc.",aliases:["google","alphabet","googl","goog","sundar pichai","youtube"],keywords:["search","ads","android","chrome","gemini","waymo","cloud","ai"],sector:"Technology",related:["META","MSFT","AAPL","AMZN"]},{id:"AMZN",type:"company",name:"Amazon.com Inc.",aliases:["amazon","amzn","aws","andy jassy","jeff bezos","prime"],keywords:["ecommerce","cloud","aws","prime","alexa","warehouse","logistics","retail"],sector:"Technology",related:["MSFT","GOOGL","WMT","COST"]},{id:"META",type:"company",name:"Meta Platforms Inc.",aliases:["meta","facebook","fb","mark zuckerberg","zuckerberg","instagram","whatsapp"],keywords:["social media","metaverse","vr","reels","advertising","llama","ai"],sector:"Technology",related:["GOOGL","SNAP","PINS"]},{id:"TSM",type:"company",name:"Taiwan Semiconductor",aliases:["tsmc","tsm","taiwan semi","taiwan semiconductor"],keywords:["chip","foundry","semiconductor","fab","wafer","node","nanometer","taiwan"],sector:"Technology",related:["NVDA","AMD","AAPL","AVGO","INTC"]},{id:"AVGO",type:"company",name:"Broadcom Inc.",aliases:["broadcom","avgo","avago","hock tan"],keywords:["chip","semiconductor","wireless","5g","networking","infrastructure","vmware","enterprise"],sector:"Technology",related:["NVDA","QCOM","TSM","INTC"]},{id:"ORCL",type:"company",name:"Oracle Corporation",aliases:["oracle","orcl","larry ellison","ellison"],keywords:["database","cloud","enterprise","java","erp","saas"],sector:"Technology",related:["MSFT","SAP","CRM"]},{id:"NFLX",type:"company",name:"Netflix Inc.",aliases:["netflix","nflx"],keywords:["streaming","entertainment","movies","series","subscription","content"],sector:"Technology",related:["DIS","WBD","PARA"]},{id:"LMT",type:"company",name:"Lockheed Martin",aliases:["lockheed","lockheed martin","lmt","skunk works"],keywords:["f-35","defense","missile","aerospace","himars","javeline"],sector:"Defense",related:["RTX","NOC","GD","BA"]},{id:"RTX",type:"company",name:"RTX Corp",aliases:["raytheon","rtx","pratt & whitney","collins aerospace"],keywords:["missile","patriot","defense","radar","engine"],sector:"Defense",related:["LMT","NOC","GD"]},{id:"NOC",type:"company",name:"Northrop Grumman",aliases:["northrop","northrop grumman","noc"],keywords:["b-21","bomber","space","defense","drone"],sector:"Defense",related:["LMT","RTX","L3H"]},{id:"BA",type:"company",name:"Boeing",aliases:["boeing","ba"],keywords:["airplane","737 max","defense","space","starliner"],sector:"Defense",related:["AIR.PA","LMT"]},{id:"GD",type:"company",name:"General Dynamics",aliases:["general dynamics","gd"],keywords:["submarine","tank","abrams","gulfstream","defense"],sector:"Defense",related:["LMT","HII"]},{id:"RHM.DE",type:"company",name:"Rheinmetall AG",aliases:["rheinmetall","rhm"],keywords:["tank","leopard","ammunition","defense","germany"],sector:"Defense",related:["KMW","BAE.L"]},{id:"AIR.PA",type:"company",name:"Airbus SE",aliases:["airbus","eads"],keywords:["airplane","defense","helicopter","space","europe"],sector:"Defense",related:["BA","SAF.PA"]},{id:"ASML",type:"company",name:"ASML Holding",aliases:["asml"],keywords:["lithography","euv","duv","chip equipment","semiconductor"],sector:"Technology",related:["TSM","INTC","SAMSUNG"]},{id:"005930.KS",type:"company",name:"Samsung Electronics",aliases:["samsung","samsung electronics"],keywords:["memory","chip","phone","display","foundry"],sector:"Technology",related:["SK hynix","AAPL","TSM"]},{id:"ALB",type:"company",name:"Albemarle",aliases:["albemarle","alb"],keywords:["lithium","battery","ev","mining"],sector:"Materials",related:["SQM","TSLA"]},{id:"SQM",type:"company",name:"SQM",aliases:["sqm","sociedad quimica"],keywords:["lithium","chile","mining","battery"],sector:"Materials",related:["ALB"]},{id:"MP",type:"company",name:"MP Materials",aliases:["mp materials","mountain pass"],keywords:["rare earth","neodymium","magnet","mining","china alternative"],sector:"Materials",related:["ARE"]},{id:"FCX",type:"company",name:"Freeport-McMoRan",aliases:["freeport","fcx"],keywords:["copper","gold","mining","indonesia","grasberg"],sector:"Materials",related:["SCCO","RIO"]},{id:"BRK-B",type:"company",name:"Berkshire Hathaway",aliases:["berkshire","berkshire hathaway","brk","warren buffett","buffett","charlie munger"],keywords:["insurance","investing","conglomerate","value"],sector:"Finance",related:["JPM","BAC","GS"]},{id:"JPM",type:"company",name:"JPMorgan Chase",aliases:["jpmorgan","jp morgan","jpm","chase","jamie dimon","dimon"],keywords:["bank","banking","investment bank","credit","loans","interest rate"],sector:"Finance",related:["BAC","GS","MS","C"]},{id:"V",type:"company",name:"Visa Inc.",aliases:["visa"],keywords:["payments","credit card","debit","transaction","fintech"],sector:"Finance",related:["MA","AXP","PYPL"]},{id:"MA",type:"company",name:"Mastercard Inc.",aliases:["mastercard","master card"],keywords:["payments","credit card","debit","transaction","fintech"],sector:"Finance",related:["V","AXP","PYPL"]},{id:"BAC",type:"company",name:"Bank of America",aliases:["bank of america","bofa","bac","boa"],keywords:["bank","banking","mortgage","loans","credit","interest rate"],sector:"Finance",related:["JPM","WFC","C"]},{id:"LLY",type:"company",name:"Eli Lilly",aliases:["eli lilly","lilly","lly"],keywords:["pharma","drug","ozempic","diabetes","obesity","weight loss","mounjaro","zepbound"],sector:"Healthcare",related:["NVO","PFE","MRK","JNJ"]},{id:"UNH",type:"company",name:"UnitedHealth Group",aliases:["unitedhealth","united health","unh","optum"],keywords:["insurance","healthcare","managed care","medicare","medicaid"],sector:"Healthcare",related:["CVS","CI","HUM"]},{id:"NVO",type:"company",name:"Novo Nordisk",aliases:["novo nordisk","novo","nvo"],keywords:["pharma","drug","ozempic","wegovy","diabetes","obesity","glp-1","weight loss"],sector:"Healthcare",related:["LLY","PFE","MRK"]},{id:"JNJ",type:"company",name:"Johnson & Johnson",aliases:["johnson johnson","j&j","jnj","johnson and johnson"],keywords:["pharma","medical devices","consumer health","vaccine"],sector:"Healthcare",related:["PFE","MRK","ABT"]},{id:"XOM",type:"company",name:"Exxon Mobil",aliases:["exxon","exxonmobil","exxon mobil","xom","mobil"],keywords:["oil","gas","drilling","refinery","petroleum","energy","fossil fuel"],sector:"Energy",related:["CVX","COP","CL=F"]},{id:"TSLA",type:"company",name:"Tesla Inc.",aliases:["tesla","tsla","elon musk","musk"],keywords:["ev","electric vehicle","battery","autopilot","fsd","robotaxi","energy storage","solar"],sector:"Consumer",related:["RIVN","LCID","F","GM"]},{id:"WMT",type:"company",name:"Walmart Inc.",aliases:["walmart","wmt","wal-mart"],keywords:["retail","grocery","ecommerce","stores","consumer","discount"],sector:"Consumer",related:["COST","TGT","AMZN"]},{id:"COST",type:"company",name:"Costco Wholesale",aliases:["costco","cost"],keywords:["retail","wholesale","membership","grocery","warehouse"],sector:"Consumer",related:["WMT","TGT","BJ"]},{id:"HD",type:"company",name:"Home Depot",aliases:["home depot","hd","homedepot"],keywords:["retail","home improvement","construction","housing","diy"],sector:"Consumer",related:["LOW","WMT"]},{id:"PG",type:"company",name:"Procter & Gamble",aliases:["procter gamble","p&g","pg","procter & gamble","procter and gamble"],keywords:["consumer goods","household","personal care","detergent","beauty"],sector:"Consumer",related:["KO","PEP","CL","UL"]},{id:"XLK",type:"sector",name:"Technology Select Sector",aliases:["tech sector","technology sector","xlk"],keywords:["tech","software","hardware","it"],related:["AAPL","MSFT","NVDA"]},{id:"XLF",type:"sector",name:"Financial Select Sector",aliases:["finance sector","financial sector","xlf","banks"],keywords:["bank","insurance","financial"],related:["JPM","BAC","V"]},{id:"XLE",type:"sector",name:"Energy Select Sector",aliases:["energy sector","xle","oil stocks"],keywords:["oil","gas","energy","drilling"],related:["XOM","CVX","CL=F"]},{id:"XLV",type:"sector",name:"Health Care Select Sector",aliases:["healthcare sector","health sector","xlv","pharma stocks"],keywords:["pharma","biotech","healthcare","medical"],related:["LLY","UNH","JNJ"]},{id:"SMH",type:"sector",name:"Semiconductor ETF",aliases:["semis","semiconductor sector","smh","chip stocks"],keywords:["chip","semiconductor","foundry","fab"],related:["NVDA","TSM","AVGO","AMD"]},{id:"^VIX",type:"commodity",name:"VIX Volatility Index",aliases:["vix","fear index","volatility"],keywords:["volatility","fear","uncertainty","hedging","options"],related:["^GSPC"]},{id:"GC=F",type:"commodity",name:"Gold Futures",aliases:["gold","xau","bullion"],keywords:["precious metal","safe haven","inflation hedge","bullion","jewelry"],related:["SI=F","GLD"]},{id:"CL=F",type:"commodity",name:"Crude Oil WTI",aliases:["oil","crude","wti","crude oil","petroleum","brent"],keywords:["opec","drilling","refinery","barrel","pipeline","energy","gasoline","fuel"],related:["NG=F","XOM","CVX","XLE"]},{id:"NG=F",type:"commodity",name:"Natural Gas Futures",aliases:["natural gas","natgas","gas"],keywords:["lng","pipeline","heating","energy","utility"],related:["CL=F","XLE"]},{id:"SI=F",type:"commodity",name:"Silver Futures",aliases:["silver","xag"],keywords:["precious metal","industrial metal","solar","electronics"],related:["GC=F","HG=F"]},{id:"HG=F",type:"commodity",name:"Copper Futures",aliases:["copper"],keywords:["industrial metal","construction","wiring","ev","infrastructure"],related:["SI=F","GC=F"]},{id:"bitcoin",type:"crypto",name:"Bitcoin",aliases:["bitcoin","btc","satoshi"],keywords:["cryptocurrency","blockchain","digital currency","halving","btc mining"],related:["ethereum","solana"]},{id:"ethereum",type:"crypto",name:"Ethereum",aliases:["ethereum","eth","ether","vitalik"],keywords:["smart contract","defi","nft","blockchain","eth gas"],related:["bitcoin","solana"]},{id:"solana",type:"crypto",name:"Solana",aliases:["solana","sol token"],keywords:["blockchain","defi","nft","solana network"],related:["bitcoin","ethereum"]},{id:"CN",type:"country",name:"China",aliases:["china","chinese","beijing","prc","xi jinping"],keywords:["trade war","tariff","ccp","pla","taiwan strait","south china sea","yuan","rmb"],related:["TW","TSM","BABA"]},{id:"TW",type:"country",name:"Taiwan",aliases:["taiwan","taiwanese","taipei","roc"],keywords:["strait","semiconductor","chip","invasion","blockade"],related:["CN","TSM","NVDA"]},{id:"RU",type:"country",name:"Russia",aliases:["russia","russian","moscow","kremlin","putin","vladimir putin"],keywords:["sanctions","ukraine","war","gas","oil","nato","nuclear"],related:["UA","CL=F","NG=F"]},{id:"UA",type:"country",name:"Ukraine",aliases:["ukraine","ukrainian","kyiv","kiev","zelenskyy","zelensky"],keywords:["war","invasion","grain","nato","aid","defense"],related:["RU","CL=F","GC=F"]},{id:"IR",type:"country",name:"Iran",aliases:["iran","iranian","tehran","khamenei","irgc"],keywords:["sanctions","nuclear","oil","strait of hormuz","proxy","hezbollah","houthi"],related:["IL","CL=F","SA"]},{id:"IL",type:"country",name:"Israel",aliases:["israel","israeli","tel aviv","jerusalem","netanyahu","idf"],keywords:["gaza","hamas","hezbollah","iran","defense","war","middle east"],related:["IR","CL=F"]},{id:"SA",type:"country",name:"Saudi Arabia",aliases:["saudi","saudi arabia","riyadh","mbs","aramco"],keywords:["opec","oil","production","cut","crude","energy"],related:["CL=F","IR","XOM"]},{id:"AE",type:"country",name:"UAE",aliases:["uae","united arab emirates","emirates","abu dhabi","dubai","mbz"],keywords:["oil","trade","g42","ai","logistics","dp world"],related:["SA","CL=F","MSFT"]},{id:"QA",type:"country",name:"Qatar",aliases:["qatar","doha","al thani"],keywords:["lng","gas","mediator","hamas","al udeid","energy"],related:["NG=F","XOM","US"]},{id:"TR",type:"country",name:"Turkey",aliases:["turkey","turkiye","erdogan","ankara"],keywords:["nato","bosphorus","drone","bayraktar","kurds","lira"],related:["RU","UA","RHM.DE"]},{id:"EG",type:"country",name:"Egypt",aliases:["egypt","cairo","sisi"],keywords:["suez canal","gaza","rafah","imf","debt","tourism"],related:["IL","SA","AE"]}];function B(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function U(n){const i=new Map,e=new Map,c=new Map,d=new Map,r=new Map;for(const a of n){i.set(a.id,a);for(const o of a.aliases)e.set(o.toLowerCase(),a.id);e.set(a.id.toLowerCase(),a.id),e.set(a.name.toLowerCase(),a.id);for(const o of a.keywords){const t=o.toLowerCase();c.has(t)||c.set(t,new Set),c.get(t).add(a.id)}if(a.sector){const o=a.sector.toLowerCase();d.has(o)||d.set(o,new Set),d.get(o).add(a.id)}r.has(a.type)||r.set(a.type,new Set),r.get(a.type).add(a.id)}return{byId:i,byAlias:e,byKeyword:c,bySector:d,byType:r}}let x=null;function C(){return x||(x=U(W)),x}function J(n){const i=C(),e=i.byId.get(n);return e!=null&&e.related?e.related.map(c=>i.byId.get(c)).filter(c=>!!c):[]}function Y(n){const i=C(),e=[],c=new Set,d=n.toLowerCase();for(const[r,a]of i.byAlias){if(r.length<3)continue;const o=new RegExp(`\\b${B(r)}\\b`,"gi");let t;for(;(t=o.exec(n))!==null;)if(!c.has(a)){e.push({entityId:a,matchedText:t[0],matchType:"alias",confidence:r.length>4?.95:.85,position:t.index}),c.add(a);break}}for(const[r,a]of i.byKeyword)if(!(r.length<3)&&d.includes(r))for(const o of a){if(c.has(o))continue;const t=d.indexOf(r);e.push({entityId:o,matchedText:r,matchType:"keyword",confidence:.7,position:t}),c.add(o)}return e.sort((r,a)=>a.confidence-r.confidence||r.position-a.position)}function q(n){const e=C().byId.get(n);return(e==null?void 0:e.name)??n}function O(n){return Y(n).map(e=>({entityId:e.entityId,name:q(e.entityId),matchedText:e.matchedText,matchType:e.matchType,confidence:e.confidence}))}function Q(n){var a;const i=O(n.primaryTitle),e=new Map;for(const o of i)e.has(o.entityId)||e.set(o.entityId,o);if(n.allItems&&n.allItems.length>1)for(const o of n.allItems.slice(0,5)){const t=O(o.title);for(const s of t)e.has(s.entityId)||(s.confidence*=.9,e.set(s.entityId,s))}const c=Array.from(e.values()).sort((o,t)=>t.confidence-o.confidence),d=(a=c[0])==null?void 0:a.entityId,r=new Set;for(const o of c){const t=J(o.entityId);for(const s of t)r.add(s.id)}return{clusterId:n.id,title:n.primaryTitle,entities:c,primaryEntity:d,relatedEntityIds:Array.from(r)}}function Z(n){const i=new Map;for(const e of n){const c=Q(e);i.set(e.id,c)}return i}function ee(n,i){const c=C().byId.get(n);if(!c)return[];const d=new Set([n,...c.related??[]]),r=[];for(const[a,o]of i){const t=o.entities.find(p=>p.entityId===n);if(t){r.push({clusterId:a,title:o.title,confidence:t.confidence});continue}const s=o.entities.find(p=>d.has(p.entityId));s&&r.push({clusterId:a,title:o.title,confidence:s.confidence*.8})}return r.sort((a,o)=>o.confidence-a.confidence)}function te(n,i){return ee(n,i)}const ne={critical:5,high:4,medium:3,low:2,info:1};function ae(n){const i=n.filter(s=>s.threat);if(i.length===0)return{level:"info",category:"general",confidence:.3,source:"keyword"};let e="info",c=0;for(const s of i){const p=ne[s.threat.level];p>c&&(c=p,e=s.threat.level)}const d=new Map;for(const s of i){const p=s.threat.category;d.set(p,(d.get(p)??0)+1)}let r="general",a=0;for(const[s,p]of d)p>a&&(a=p,r=s);let o=0,t=0;for(const s of i){const p=s.tier?6-Math.min(s.tier,5):1;o+=s.threat.confidence*p,t+=p}return{level:e,category:r,confidence:t>0?o/t:.5,source:"keyword"}}function oe(n){const e=[...n].sort((c,d)=>c.pubDate.getTime()-d.pubDate.getTime())[0];return`${e.pubDate.getTime()}-${e.title.slice(0,20).replace(/\W/g,"")}`}function ie(n,i){if(n.length===0)return[];const e=n.map(t=>({...t,tier:t.tier??i(t.source)})),c=new Map,d=[],r=new Map;for(const t of e){const s=j(t.title);c.set(t.title,s),d.push(s)}for(let t=0;t<d.length;t++){const s=d[t];for(const p of s){const h=r.get(p);h?h.push(t):r.set(p,[t])}}const a=[],o=new Set;for(let t=0;t<e.length;t++){if(o.has(t))continue;const p=[e[t]];o.add(t);const h=d[t],S=new Set;for(const w of h){const b=r.get(w);if(b)for(const T of b)T>t&&S.add(T)}const A=Array.from(S).sort((w,b)=>w-b);for(const w of A){if(o.has(w))continue;const b=e[w],T=d[w];X(h,T)>=.5&&(p.push(b),o.add(w))}a.push(p)}return a.map(t=>{var l;const s=[...t].sort((m,u)=>{const y=m.tier-u.tier;return y!==0?y:u.pubDate.getTime()-m.pubDate.getTime()}),p=s[0],h=t.map(m=>m.pubDate.getTime()),S=s.slice(0,3).map(m=>({name:m.source,tier:m.tier,url:m.link})),A=ae(t),w=t.filter(m=>m.lat!=null&&m.lon!=null);let b,T;if(w.length>0){const m=new Map;for(const y of w){const f=`${y.lat},${y.lon}`,g=m.get(f)||{lat:y.lat,lon:y.lon,count:0};g.count++,m.set(f,g)}const u=Array.from(m.values()).sort((y,f)=>f.count-y.count)[0];b=u.lat,T=u.lon}return{id:oe(t),primaryTitle:p.title,primarySource:p.source,primaryLink:p.link,sourceCount:t.length,topSources:S,allItems:t,firstSeen:new Date(Math.min(...h)),lastUpdated:new Date(Math.max(...h)),isAlert:t.some(m=>m.isAlert),monitorColor:(l=t.find(m=>m.monitorColor))==null?void 0:l.monitorColor,threat:A,...b!=null&&{lat:b,lon:T}}}).sort((t,s)=>s.lastUpdated.getTime()-t.lastUpdated.getTime())}function se(n){var e;const i=new Map;for(const c of n){const d=c.primaryTitle.toLowerCase();for(const r of H)if(d.includes(r)){const a=((e=c.velocity)==null?void 0:e.sourcesPerHour)??0;i.set(r,(i.get(r)??0)+a+c.sourceCount)}}return i}function re(n,i,e){var d;const c=[];for(const r of n){const a=[r.primaryTitle,...((d=r.allItems)==null?void 0:d.map(s=>s.title))??[]].map(s=>s.toLowerCase()).filter(Boolean),o=a.some(s=>E(s,V)),t=a.some(s=>E(s,$));if(o&&t){const s=I("flow_drop",r.id,r.sourceCount);i(s)||(e(s),c.push({id:M(),type:"flow_drop",title:"Pipeline Flow Drop",description:`"${r.primaryTitle.slice(0,70)}..." indicates reduced flow or disruption`,confidence:Math.min(.9,.4+r.sourceCount/10),timestamp:new Date,data:{newsVelocity:r.sourceCount,relatedTopics:["pipeline","flow"]}}))}}return c}function ce(n,i,e,c){const d=[],a=Date.now();for(const o of n){if(!o.allItems||o.allItems.length<3)continue;const t=o.allItems.filter(p=>a-p.pubDate.getTime()<36e5);if(t.length<3)continue;const s=new Set;for(const p of t){const h=i(p.source);s.add(h)}if(s.size>=3){const p=Array.from(s).filter(S=>S!=="other"),h=I("convergence",o.id,s.size);!e(h)&&p.length>=3&&(c(h),d.push({id:M(),type:"convergence",title:"Source Convergence",description:`"${o.primaryTitle.slice(0,50)}..." reported by ${p.join(", ")} (${t.length} sources in 30m)`,confidence:Math.min(.95,.6+s.size*.1),timestamp:new Date,data:{newsVelocity:t.length,relatedTopics:p}}))}}return d}function le(n,i,e,c){const d=[],r=["wire","gov","intel"];for(const a of n){if(!a.allItems||a.allItems.length<3)continue;const o=new Set;for(const t of a.allItems){const s=i(t.source);r.includes(s)&&o.add(s)}if(o.size===3){const t=I("triangulation",a.id,3);e(t)||(c(t),d.push({id:M(),type:"triangulation",title:"Intel Triangulation",description:`Wire + Gov + Intel aligned: "${a.primaryTitle.slice(0,45)}..."`,confidence:.9,timestamp:new Date,data:{newsVelocity:a.sourceCount,relatedTopics:Array.from(o)}}))}}return d}function de(n,i,e,c,d,r,a){var T;const o=[],t=Date.now(),s=se(n),p=re(n,r,a),h=p.length,S=C(),A=Z(n),w={newsVelocity:s,marketChanges:new Map(e.map(l=>[l.symbol,l.change??0])),predictionChanges:new Map(i.map(l=>[l.title.slice(0,50),l.yesPrice])),timestamp:t};if(!c)return{signals:[],snapshot:w};for(const l of i){const m=l.title.slice(0,50),u=c.predictionChanges.get(m);if(u!==void 0){const y=Math.abs(l.yesPrice-u);if(y>=P){const f=K(l.title),g=f.reduce((L,ye)=>L+(s.get(ye)??0),0),k=I("prediction_leads_news",m,y);g<F&&!r(k)&&(a(k),o.push({id:M(),type:"prediction_leads_news",title:"Prediction Market Shift",description:`"${l.title.slice(0,60)}..." moved ${y>0?"+":""}${y.toFixed(1)}% with low news coverage`,confidence:Math.min(.9,.5+y/20),timestamp:new Date,data:{predictionShift:y,newsVelocity:g,relatedTopics:f}}))}}}for(const[l,m]of s){const u=c.newsVelocity.get(l)??0;if(m>F*2&&m>u*2){const y=I("velocity_spike",l,m);r(y)||(a(y),o.push({id:M(),type:"velocity_spike",title:"News Velocity Spike",description:`"${l}" coverage surging: ${m.toFixed(1)} activity score`,confidence:Math.min(.85,.4+m/20),timestamp:new Date,data:{newsVelocity:m,relatedTopics:[l]}}))}}for(const l of e){const m=Math.abs(l.change??0);if(m<G)continue;const u=S.byId.get(l.symbol),y=te(l.symbol,A);if(y.length>0){const f=y[0],g=I("explained_market_move",l.symbol,m);if(!r(g)){a(g);const k=l.change>0?"+":"";o.push({id:M(),type:"explained_market_move",title:"Market Move Explained",description:`${l.name} ${k}${l.change.toFixed(2)}% correlates with: "${f.title.slice(0,60)}..."`,confidence:Math.min(.9,.5+y.length*.1+m/20),timestamp:new Date,data:{marketChange:l.change,newsVelocity:y.length,correlatedEntities:[l.symbol],correlatedNews:y.map(L=>L.clusterId),explanation:`${y.length} related news item${y.length>1?"s":""} found`}})}}else{const f=Array.from(s.entries()).filter(([k])=>l.name.toLowerCase().includes(k)||k.includes(l.symbol.toLowerCase())).reduce((k,[,L])=>k+L,0),g=I("silent_divergence",l.symbol,m);if(f<2&&!r(g)){a(g);const k=u?[l.symbol,l.name,...((T=u.keywords)==null?void 0:T.slice(0,2))??[]].join(", "):l.symbol;o.push({id:M(),type:"silent_divergence",title:"Silent Divergence",description:`${l.name} moved ${l.change>0?"+":""}${l.change.toFixed(2)}% - no news found for: ${k}`,confidence:Math.min(.8,.4+m/10),timestamp:new Date,data:{marketChange:l.change,newsVelocity:f,explanation:`Searched: ${k}`}})}}}for(const l of e){if(!_.has(l.symbol))continue;const m=l.change??0;if(m>=R){const u=Array.from(s.entries()).filter(([f])=>l.name.toLowerCase().includes(f)||f.includes(l.symbol.toLowerCase())).reduce((f,[,g])=>f+g,0),y=I("flow_price_divergence",l.symbol,m);u<2&&h===0&&!r(y)&&(a(y),o.push({id:M(),type:"flow_price_divergence",title:"Flow/Price Divergence",description:`${l.name} up ${m.toFixed(2)}% without pipeline flow news`,confidence:Math.min(.85,.4+m/8),timestamp:new Date,data:{marketChange:m,newsVelocity:u,relatedTopics:["pipeline",l.display]}}))}}return o.push(...ce(n,d,r,a)),o.push(...le(n,d,r,a)),o.push(...p),{signals:o.filter((l,m)=>o.findIndex(u=>u.type===l.type)===m).filter(l=>l.confidence>=.6),snapshot:w}}let D=null;const v=new Set;function me(n){return v.has(n)}function pe(n){v.add(n),setTimeout(()=>v.delete(n),1800*1e3)}self.onmessage=n=>{const i=n.data;switch(i.type){case"cluster":{const e=i.items.map(a=>({...a,pubDate:new Date(a.pubDate)})),d=ie(e,a=>i.sourceTiers[a]??4),r={type:"cluster-result",id:i.id,clusters:d};self.postMessage(r);break}case"correlation":{const e=i.clusters.map(o=>({...o,firstSeen:new Date(o.firstSeen),lastUpdated:new Date(o.lastUpdated),allItems:o.allItems.map(t=>({...t,pubDate:new Date(t.pubDate)}))})),c=o=>i.sourceTypes[o]??"other",{signals:d,snapshot:r}=de(e,i.predictions,i.markets,D,c,me,pe);D=r;const a={type:"correlation-result",id:i.id,signals:d};self.postMessage(a);break}case"reset":{D=null,v.clear();break}}},self.postMessage({type:"ready"})})();
